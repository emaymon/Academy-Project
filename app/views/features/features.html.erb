<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">

  <!-- If IE use the latest rendering engine -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!-- Set the page to the width of the device and set the zoon level -->
  <meta name="viewport" content="width = device-width, initial-scale = 1">
  <title>YOTPO Admin Dashboard</title>
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

  <style>
      .jumbotron{
          background-color:#2E2D88;
          color:white;
      }
      .scrollable-menu {
          height: auto;
          max-height: 200px;
          width: 506px;
          overflow-x: hidden;
      }
      li{
          color: #999999;
      }
      #en,#dis{
          display:inline;
      }
      #block_container{
          text-align: center;
      }

  </style>

</head>
<body>

    <div class="container">

      <div class="page-header" align="center">
        <h1>Admin Dashboard</h1>
        <img src="yotpo-logo.png" id="Logo" width="100" height="100" >
      </div>

      <div class="jumbotron" id="generalDiv">
          <div class="input-group input-group-sm">
            <input type="text" class="form-control" placeholder="AppKey" id="appkey">
              <span class="input-group-btn">
                <button class="btn btn-default" type="button" onclick="showAccountFeatures()"><span class="glyphicon glyphicon-search"></span>Search</button>
              </span>
          </div><br>
        <div id="block_container">
          <p id="en" style="display: none;">Enabled Features</p>
          <p id="dis" style="display: none;">Disabled Features</p>
        </div>
        <span>
          <ul id="enabled-list" class="scrollable-menu" role="menu" style="list-style-type:none; display: inline-block; background-color:#ffffff; border-radius:5px;"></ul>
          <ul id="disabled-list" class="scrollable-menu" role="menu" style="list-style-type:none; display: inline-block; background-color:#ffffff; border-radius:5px;"></ul>
        </span>
      </div>
    </div>

    <script>
        function showAccountFeatures() {
            var url = document.getElementById("appkey").value;
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open( "GET", "http://localhost:3000/accounts/" + url + "/features", false );
            xmlHttp.send( null );
            var accountFeatures=JSON.parse(xmlHttp.responseText);
            var xmlHttp2 = new XMLHttpRequest();
            xmlHttp2.open( "GET", "http://localhost:3000/featuresJ", false );
            xmlHttp2.send( null );
            var allFeatures=JSON.parse(xmlHttp2.responseText);
            try {
                if (accountFeatures['status']['code'] == 404) {
                    alert("Please insert a valid AppKey");
                }
            }
            catch(err){
                var disabledFeatures = _.difference(_.pluck(allFeatures, 'id'), _.pluck(accountFeatures, 'id'));
                disabledFeatures = _.map(disabledFeatures, function(num){
                    var xmlHttpId = new XMLHttpRequest();
                    xmlHttpId.open( "GET", "http://localhost:3000/featuresJ/" + num, false );
                    xmlHttpId.send( null );
                    return JSON.parse(xmlHttpId.responseText);
                })
                accountFeatures=_.sortBy(accountFeatures, 'name');
                disabledFeatures=_.sortBy(disabledFeatures, 'name');
                var enabledList = document.getElementById("enabled-list");
                enabledList.innerHTML = "";
                var disabledList = document.getElementById("disabled-list");
                disabledList.innerHTML = "";
                for (var index in accountFeatures) {
                    var child = document.createElement("LI");
                    var div = document.createElement("DIV");
                    var label = document.createElement("LABEL");
                    var input = document.createElement("INPUT");
                    var textnode = document.createTextNode(accountFeatures[index].name);
                    input.type = "checkbox";
                    input.value = "";
                    label.appendChild(input);
                    label.appendChild(textnode);
                    div.appendChild(label);
                    child.appendChild(div);
                    enabledList.appendChild(child);
                }
                for (index in disabledFeatures) {
                    var childD = document.createElement("LI");
                    var divD = document.createElement("DIV");
                    var labelD = document.createElement("LABEL");
                    var inputD = document.createElement("INPUT");
                    var textnodeD = document.createTextNode(disabledFeatures[index].name);
                    inputD.type = "checkbox";
                    inputD.value = "";
                    labelD.appendChild(inputD);
                    labelD.appendChild(textnodeD);
                    divD.appendChild(labelD);
                    childD.appendChild(divD);
                    disabledList.appendChild(childD);
                }
            }
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
</body>
</html>