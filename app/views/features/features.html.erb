<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">

  <!-- If IE use the latest rendering engine -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!-- Set the page to the width of the device and set the zoon level -->
  <meta name="viewport" content="width = device-width, initial-scale = 1">
  <title>YOTPO Admin Dashboard</title>
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

  <style>
      .jumbotron{
          background-color:#002266;
          color:white;
      }

      .scrollable-menu {
          height: auto;
          max-height: 200px;
          width: 506px;
          overflow-x: hidden;
      }

      li{
          color: #999999;
          font-size: small;
      }

      .hidden{
          display:none;
      }

      .center-aligned-text{
          text-align: center;
      }

      .left-aligned{
          float: left;
      }

      .right-aligned{
          float: right;
      }

      .margin-left-18{
          margin-left: 18%;
      }

      .margin-right-18{
          margin-right: 18%;
      }

      .margin-left-16{
          margin-left: 16%;
      }

      .margin-right-16{
          margin-right: 16%;
      }

      .simple-listed{
          list-style-type:none;
          display: inline-block;
          background-color:#ffffff;
          border-radius:5px;
      }

      .footer {
          position: absolute;
          right: 0;
          bottom: 0;
          left: 0;
          padding: 1rem;
          background-color: #efefef;
          text-align: center;
      }

  </style>

</head>
<body>
    <div class="container">
      <div class="page-header" align="center">
        <h1>Admin Dashboard</h1>
        <img src="yotpo-logo.png" width="100" height="100" >
      </div>

      <div class="jumbotron">
          <div class="input-group input-group-sm">
            <input id="appkey" type="text" class="form-control" placeholder="AppKey">
              <span class="input-group-btn">
                <button class="btn btn-default" type="button" onclick="showAccountFeatures()"><span class="glyphicon glyphicon-search"></span>Search</button>
              </span>
          </div><br>
        <div class="center-aligned-text">
          <p id="enable-paragraph" class="hidden left-aligned margin-left-18">Enabled Features</p>
          <p id="disable-paragraph" class="hidden right-aligned margin-right-18">Disabled Features</p>
        </div>
        <span>
          <ul id="enabled-list" class="scrollable-menu simple-listed" role="menu"></ul>
          <ul id="disabled-list" class="scrollable-menu simple-listed" role="menu"></ul>
        </span>
        <div class="center-aligned-text">
          <button id="disable-button" class="btn btn-default hidden left-aligned margin-left-16" type="button" onclick="disableFeatures()">Disable Selected Features</button>
          <button id="enable-button" class="btn btn-default hidden right-aligned margin-right-16" type="button" onclick="enableFeatures()">Enable Selected Features</button>
        </div>
      </div>
    </div>
    <footer class="footer">
      <div class="container">
        <p class="text-muted">Yotpo NEW Admin</p>
      </div>
    </footer>

    <script>
        function showAccountFeatures() {
            var url = document.getElementById("appkey").value;
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open( "GET", "http://localhost:3000/accounts/" + url + "/features", false );
            xmlHttp.send( null );
            var accountFeatures=JSON.parse(xmlHttp.responseText);
            var xmlHttp2 = new XMLHttpRequest();
            xmlHttp2.open( "GET", "http://localhost:3000/featuresJ", false );
            xmlHttp2.send( null );
            var allFeatures=JSON.parse(xmlHttp2.responseText);
            try {
                if (accountFeatures['status']['code'] == 404) {
                    alert("Please insert a valid AppKey");
                }
            }
            catch(err){
                var disabledFeatures = _.difference(_.pluck(allFeatures, 'id'), _.pluck(accountFeatures, 'id'));
                disabledFeatures = _.map(disabledFeatures, function(num){
                    return _.findWhere(allFeatures, {id: num});
                })
                accountFeatures=_.sortBy(accountFeatures, 'name');
                disabledFeatures=_.sortBy(disabledFeatures, 'name');
                var enabledList = document.getElementById("enabled-list");
                enabledList.innerHTML = "";
                var disabledList = document.getElementById("disabled-list");
                disabledList.innerHTML = "";
                for (var index in accountFeatures) {
                    var child = createCheckBox(accountFeatures[index], "enable-checkbox");
                    enabledList.appendChild(child);
                }
                for (index in disabledFeatures) {
                    var child = createCheckBox(disabledFeatures[index], "disable-checkbox");
                    disabledList.appendChild(child);
                }

                document.getElementById('enable-paragraph').classList.remove('hidden');
                document.getElementById('disable-paragraph').classList.remove('hidden');
                document.getElementById('enable-button').classList.remove('hidden');
                document.getElementById('disable-button').classList.remove('hidden');
            }
        }

        function createCheckBox(feature, nodeName){
            var child = document.createElement("LI");
            var div = document.createElement("DIV");
            var label = document.createElement("LABEL");
            var input = document.createElement("INPUT");
            var textnode = document.createTextNode(feature.name);
            input.type = "checkbox";
            input.name = nodeName;
            input.value= feature.id;
            label.appendChild(input);
            label.appendChild(textnode);
            div.appendChild(label);
            child.appendChild(div);
            return child;
        }

        function enableFeatures(){
            var disabled =  document.getElementsByName('disable-checkbox');
            for (var i=0; i<disabled.length; i++){
                if (disabled[i].checked){
                    var url = document.getElementById("appkey").value;
                    var id = disabled[i].value;
                    var xmlHttp = new XMLHttpRequest();
                    xmlHttp.open( "POST", "http://localhost:3000/accounts/" + url + "/features/" + id, false );
                    xmlHttp.send( null );
                }
            }
            showAccountFeatures();
        }

        function disableFeatures(){
            var enabled =  document.getElementsByName('enable-checkbox');
            for (var i=0; i<enabled.length; i++){
                if (enabled[i].checked){
                    var url = document.getElementById("appkey").value;
                    var id = enabled[i].value;
                    var xmlHttp = new XMLHttpRequest();
                    xmlHttp.open( "DELETE", "http://localhost:3000/accounts/" + url + "/features/" + id, false );
                    xmlHttp.send( null );
                }
            }
            showAccountFeatures();
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
</body>
</html>